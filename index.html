<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SlipBot Simulator</title>
<meta property="og:title" content="tdisney.com">
<meta property="og:description" content="SlipBot Workflow Simulator">
<meta property="og:image" content="https://thomasdisney.github.io/thumbnail.jpg">
<meta property="og:url" content="https://thomasdisney.github.io">
<meta name="twitter:card" content="summary_large_image">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<style>
body,html{height:60%;margin:0;padding:0;background:#FFF;color:#00c600;font-family:'IBM PLEX MONO',monospace;line-height:1;display:flex;flex-direction:column;overflow:hidden}
.container{flex:0 0 auto;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:10px;box-sizing:border-box;max-width:100%;width:100%;background-color:rgba(0,0,0,0.8);z-index:5}
h1{font-size:2em;margin-bottom:10px;text-align:left}
.controls{display:flex;justify-content:center;align-items:center;gap:20px;margin-bottom:10px}
.control-link{color:#00c600;text-decoration:underline;cursor:none;font-family:inherit;font-size:1em;transition:all 0.2s ease}
.control-link:hover{color:#00ff00}
input[type="file"]{display:none}
input[type="range"]{-webkit-appearance:none;width:200px;height:2px;background:#00c600;outline:none;opacity:0.7;transition:opacity 0.2s}
input[type="range"]:hover{opacity:5}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:15px;height:15px;background:#00c600;cursor:none;border-radius:50%}
input[type="range"]::-moz-range-thumb{width:15px;height:15px;background:#00c600;cursor:none;border-radius:50%}
.draggable{position:absolute;touch-action:none;user-select:none;z-index:2}
.rotate-slow{transition:transform 0.3s ease}
.dragging,.draggable{cursor:none}
@keyframes dissolveRightToLeft{0%{clip-path:inset(0 0 0 0)}100%{clip-path:inset(100% 0 0 0)}}
.dissolve-right-to-left{animation:dissolveRightToLeft 1.5s ease-in-out forwards}
.background-image{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(1);max-width:100%;max-height:100%;object-fit:contain;z-index:1}
.background-image.selected{box-shadow:0 0 10px 5px #00ff00}
.toggle-switch{position:relative;display:inline-block;width:40px;height:20px}
.toggle-switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:20px}
.slider:before{position:absolute;content:"";height:16px;width:16px;left:2px;bottom:2px;background-color:white;transition:.4s;border-radius:50%}
input:checked + .slider{background-color:#00c600}
input:checked + .slider:before{transform:translateX(20px)}
</style>
</head>
<body>
<div class="container">
<h1>SlipBot Simulator</h1>
<div class="controls">
<span class="control-link" id="addBotBtn">[add SlipBot]</span>
<span class="control-link" id="addtrlrBtn">[add trailer]</span>
<label for="backgroundUpload" class="control-link">[upload layout]</label>
<input type="file" id="backgroundUpload" accept="image/*" multiple>
<label class="toggle-switch">
<input type="checkbox" id="backgroundToggle" checked>
<span class="slider"></span>
</label>
<input type="range" id="scaleBackground" min="10" max="200" value="100">
</div>
</div>
<script>
const getCenter = (el) => {
    const rect = el.getBoundingClientRect();
    return { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
};

const rotatePoint = (x, y, cx, cy, angle) => {
    const radians = (Math.PI / 180) * angle,
          cos = Math.cos(radians),
          sin = Math.sin(radians),
          nx = (cos * (x - cx)) + (sin * (y - cy)) + cx,
          ny = (cos * (y - cy)) - (sin * (x - cx)) + cy;
    return { x: nx, y: ny };
};

const checkOverlap = (elem1, elem2) => {
    const rect1 = elem1.getBoundingClientRect(),
          rect2 = elem2.getBoundingClientRect();
    return !(rect1.right < rect2.left || rect1.left > rect2.right ||
             rect1.bottom < rect2.top || rect1.top > rect2.bottom);
};

function addDraggableImage(imageSrc, event) {
    const img = document.createElement('img');
    img.src = imageSrc;
    img.classList.add('draggable');
    img.style.position = 'absolute';
    img.style.left = `${event.clientX}px`;
    img.style.top = `${event.clientY}px`;
    img.style.transformOrigin = 'center';
    document.body.appendChild(img);

    let isDragging = imageSrc === 'Slipbot.png', 
        rotateDeg = 0,
        isImageLoaded = false,
        isMirrored = false;

    const state = {
        offsetX: 0,
        offsetY: 0,
        startX: 0,
        startY: 0,
        lastX: 0,
        lastY: 0
    };

    img.onload = function() {
        if (imageSrc === 'truck.png') {
            img.style.width = `${this.width}px`;
            img.style.height = 'auto';
        } else {
            img.style.width = '40px';
            img.style.height = 'auto';
        }
    };

    let attachedElements = new Set();

    function updateAttachedElements(rootEl) {
        attachedElements.clear();
        document.querySelectorAll('img.draggable').forEach(el => {
            if (el !== rootEl && checkOverlap(rootEl, el)) {
                attachedElements.add(el);
            }
        });
    }

    function moveElement(el, dx, dy) {
        const left = parseFloat(el.style.left) + dx;
        const top = parseFloat(el.style.top) + dy;
        el.style.left = `${left}px`;
        el.style.top = `${top}px`;
    }

    function rotateElement(el, angle) {
        el.style.transform = `rotate(${angle}deg) scaleY(${isMirrored ? -1 : 1})`;
    }

    function mirrorElement(el) {
        isMirrored = !isMirrored;
        el.style.transform = `rotate(${rotateDeg}deg) scaleY(${isMirrored ? -1 : 1})`;
    }

    function onMouseMove(e) {
        if (!isDragging) return;

        const dx = e.clientX - state.lastX;
        const dy = e.clientY - state.lastY;

        moveElement(img, dx, dy);
        attachedElements.forEach(el => moveElement(el, dx, dy));

        state.lastX = e.clientX;
        state.lastY = e.clientY;
    }

    function onMouseUp() {
        if (imageSrc === 'truck.png') {
            isDragging = false;
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
        }
    }

    if (imageSrc === 'Slipbot.png') {
        state.offsetX = event.clientX - parseFloat(img.style.left);
        state.offsetY = event.clientY - parseFloat(img.style.top);
        state.lastX = event.clientX;
        state.lastY = event.clientY;
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);

        img.addEventListener('click', function(e) {
            isDragging = !isDragging;
            if (isDragging) {
                state.offsetX = e.clientX - parseFloat(img.style.left);
                state.offsetY = e.clientY - parseFloat(img.style.top);
                state.lastX = e.clientX;
                state.lastY = e.clientY;
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            } else {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }
        });

        img.addEventListener('dblclick', function(e) {
            e.preventDefault();
            rotateDeg = (rotateDeg + 45) % 360;
            rotateElement(img, rotateDeg);
        });

        img.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            if (!isImageLoaded) {
                img.src = 'SlipBot_Loaded.png';
                isImageLoaded = true;
            } else {
                img.src = 'Slipbot.png';
                isImageLoaded = false;
            }
        });
    } else if (imageSrc === 'truck.png') {
        img.addEventListener('mousedown', function(e) {
            if (e.button !== 0) return;
            isDragging = true;
            state.offsetX = e.clientX - parseFloat(img.style.left);
            state.offsetY = e.clientY - parseFloat(img.style.top);
            state.startX = e.clientX;
            state.startY = e.clientY;
            state.lastX = e.clientX;
            state.lastY = e.clientY;
            updateAttachedElements(img);
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });

        img.addEventListener('dblclick', function(e) {
            e.preventDefault();
            mirrorElement(img);
            const center = getCenter(img);
            attachedElements.forEach(el => {
                const elCenter = getCenter(el);
                const mirrored = { 
                    x: elCenter.x, 
                    y: 2 * center.y - elCenter.y 
                };
                el.style.left = `${mirrored.x - el.offsetWidth / 2}px`;
                el.style.top = `${mirrored.y - el.offsetHeight / 2}px`;
                mirrorElement(el);
            });
        });

        img.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            const prevRotateDeg = rotateDeg;
            rotateDeg = (rotateDeg + 45) % 360;
            const deltaRotate = rotateDeg - prevRotateDeg;
            
            rotateElement(img, rotateDeg);
            
            const center = getCenter(img);
            attachedElements.forEach(el => {
                const elCenter = getCenter(el);
                const rotated = rotatePoint(elCenter.x, elCenter.y, center.x, center.y, deltaRotate);
                el.style.left = `${rotated.x - el.offsetWidth / 2}px`;
                el.style.top = `${rotated.y - el.offsetHeight / 2}px`;
                rotateElement(el, rotateDeg);
            });
        });
    }
}




document.getElementById('addBotBtn').addEventListener('click',function(e){addDraggableImage('Slipbot.png',e)});
document.getElementById('addtrlrBtn').addEventListener('click',function(e){addDraggableImage('truck.png',e)});
let backgroundImages=[];let selectedBackground=null;
function addBackgroundImage(file){const reader=new FileReader();reader.onload=function(e){const img=document.createElement('img');img.src=e.target.result;img.classList.add('background-image');img.style.display='block';img.dataset.scale=1;img.dataset.rotation=0;document.body.appendChild(img);backgroundImages.push(img);selectBackgroundImage(img);makeBackgroundDraggable(img)};reader.readAsDataURL(file)}
function makeBackgroundDraggable(img){let isDragging=false;let startX,startY,startLeft,startTop;img.addEventListener('mousedown',function(e){if(document.getElementById('backgroundToggle').checked){isDragging=true;startX=e.clientX;startY=e.clientY;startLeft=img.offsetLeft;startTop=img.offsetTop;e.preventDefault()}});document.addEventListener('mousemove',function(e){if(isDragging&&document.getElementById('backgroundToggle').checked){const dx=e.clientX-startX;const dy=e.clientY-startY;img.style.left=`${startLeft+dx}px`;img.style.top=`${startTop+dy}px`}});document.addEventListener('mouseup',function(){isDragging=false});img.addEventListener('dblclick',function(e){if(document.getElementById('backgroundToggle').checked){const currentRotation=parseInt(img.dataset.rotation)||0;const newRotation=(currentRotation+90)%360;img.style.transform=`translate(-50%, -50%) scale(${img.dataset.scale}) rotate(${newRotation}deg)`;img.dataset.rotation=newRotation;e.preventDefault()}})}
function selectBackgroundImage(img){if(selectedBackground){selectedBackground.classList.remove('selected')}selectedBackground=img;selectedBackground.classList.add('selected');document.getElementById('scaleBackground').value=selectedBackground.dataset.scale*100}
document.getElementById('backgroundUpload').addEventListener('change',function(e){const files=e.target.files;for(let i=0;i<files.length;i++){addBackgroundImage(files[i])}});
document.getElementById('scaleBackground').addEventListener('input',function(e){if(selectedBackground&&document.getElementById('backgroundToggle').checked){const scale=e.target.value/100;selectedBackground.dataset.scale=scale;const rotation=selectedBackground.dataset.rotation||0;selectedBackground.style.transform=`translate(-50%, -50%) scale(${scale}) rotate(${rotation}deg)`}});
document.getElementById('backgroundToggle').addEventListener('change',function(e){const isEnabled=e.target.checked;backgroundImages.forEach(img=>{img.style.pointerEvents=isEnabled?'auto':'none';img.style.boxShadow=isEnabled?'':'none'})});
document.body.addEventListener('click',function(e){if(e.target.classList.contains('background-image')){selectBackgroundImage(e.target)}});
</script>
</body>
</html>
